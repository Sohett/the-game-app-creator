{"remainingRequest":"/Users/thomassohet/code/Sohett/perso/seraphincademy/seraphinacademy-front/node_modules/thread-loader/dist/cjs.js!/Users/thomassohet/code/Sohett/perso/seraphincademy/seraphinacademy-front/node_modules/babel-loader/lib/index.js!/Users/thomassohet/code/Sohett/perso/seraphincademy/seraphinacademy-front/node_modules/eslint-loader/index.js??ref--13-0!/Users/thomassohet/code/Sohett/perso/seraphincademy/seraphinacademy-front/src/services/auth.js","dependencies":[{"path":"/Users/thomassohet/code/Sohett/perso/seraphincademy/seraphinacademy-front/src/services/auth.js","mtime":1549299923769},{"path":"/Users/thomassohet/code/Sohett/perso/seraphincademy/seraphinacademy-front/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/thomassohet/code/Sohett/perso/seraphincademy/seraphinacademy-front/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/thomassohet/code/Sohett/perso/seraphincademy/seraphinacademy-front/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/thomassohet/code/Sohett/perso/seraphincademy/seraphinacademy-front/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.regexp.constructor\";\nimport \"core-js/modules/es6.array.iterator\";\nimport \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es7.promise.finally\";\nimport decode from 'jwt-decode';\nimport Router from 'vue-router';\nimport auth0 from 'auth0-js';\nvar ID_TOKEN_KEY = 'id_token';\nvar ACCESS_TOKEN_KEY = 'access_token';\nvar CLIENT_ID = 'MnRDJWynkCWlyN7G3hx8tMvydauGbTLO';\nvar CLIENT_DOMAIN = 'schooling.eu.auth0.com';\n\nfunction redirectUri() {\n  if (process.env.NODE_ENV === 'production') {\n    return 'https://app.schooling.host/callback';\n  } else {\n    return 'http://localhost:8080/callback';\n  }\n}\n\nvar auth = new auth0.WebAuth({\n  clientID: CLIENT_ID,\n  domain: CLIENT_DOMAIN\n});\nexport function login() {\n  auth.authorize({\n    responseType: 'token id_token',\n    redirectUri: redirectUri()\n  });\n}\nvar router = new Router({\n  mode: 'history'\n});\nexport function logout() {\n  clearIdToken();\n  clearAccessToken();\n  router.go('/');\n}\nexport function requireAuth(to, from, next) {\n  if (!isLoggedIn()) {\n    next({\n      path: '/login'\n    });\n  } else {\n    next();\n  }\n}\nexport function getIdToken() {\n  return localStorage.getItem(ID_TOKEN_KEY);\n}\nexport function getAccessToken() {\n  return localStorage.getItem(ACCESS_TOKEN_KEY);\n}\n\nfunction clearIdToken() {\n  localStorage.removeItem(ID_TOKEN_KEY);\n}\n\nfunction clearAccessToken() {\n  localStorage.removeItem(ACCESS_TOKEN_KEY);\n} // Helper function that will allow us to extract the access_token and id_token\n\n\nfunction getParameterByName(name) {\n  var match = RegExp('[#&]' + name + '=([^&]*)').exec(window.location.hash);\n  return match && decodeURIComponent(match[1].replace(/\\+/g, ' '));\n} // Get and store access_token in local storage\n\n\nexport function setAccessToken() {\n  var accessToken = getParameterByName('access_token');\n  localStorage.setItem(ACCESS_TOKEN_KEY, accessToken);\n} // Get and store id_token in local storage\n\nexport function setIdToken() {\n  var idToken = getParameterByName('id_token');\n  localStorage.setItem(ID_TOKEN_KEY, idToken);\n}\nexport function isLoggedIn() {\n  var idToken = getIdToken(); // Had to modify the Auth0 boilerplate here, as somehow the idToken is\n  // cast a the 'null' string instead of being null type the first time\n  // before any login happens...\n\n  return idToken !== 'null' && idToken !== null && !isTokenExpired(idToken);\n}\n\nfunction getTokenExpirationDate(encodedToken) {\n  var token = decode(encodedToken);\n\n  if (!token.exp) {\n    return null;\n  }\n\n  var date = new Date(0);\n  date.setUTCSeconds(token.exp);\n  return date;\n}\n\nfunction isTokenExpired(token) {\n  var expirationDate = getTokenExpirationDate(token);\n  return expirationDate < new Date();\n}",{"version":3,"sources":["/Users/thomassohet/code/Sohett/perso/seraphincademy/seraphinacademy-front/src/services/auth.js"],"names":["decode","Router","auth0","ID_TOKEN_KEY","ACCESS_TOKEN_KEY","CLIENT_ID","CLIENT_DOMAIN","redirectUri","process","env","NODE_ENV","auth","WebAuth","clientID","domain","login","authorize","responseType","router","mode","logout","clearIdToken","clearAccessToken","go","requireAuth","to","from","next","isLoggedIn","path","getIdToken","localStorage","getItem","getAccessToken","removeItem","getParameterByName","name","match","RegExp","exec","window","location","hash","decodeURIComponent","replace","setAccessToken","accessToken","setItem","setIdToken","idToken","isTokenExpired","getTokenExpirationDate","encodedToken","token","exp","date","Date","setUTCSeconds","expirationDate"],"mappings":"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","sourcesContent":["import decode from 'jwt-decode'\nimport Router from 'vue-router'\nimport auth0 from 'auth0-js'\n\nconst ID_TOKEN_KEY = 'id_token'\nconst ACCESS_TOKEN_KEY = 'access_token'\n\nconst CLIENT_ID = 'MnRDJWynkCWlyN7G3hx8tMvydauGbTLO'\nconst CLIENT_DOMAIN = 'schooling.eu.auth0.com'\n\nfunction redirectUri () {\n  if (process.env.NODE_ENV === 'production') {\n    return 'https://app.schooling.host/callback'\n  } else {\n    return 'http://localhost:8080/callback'\n  }\n}\n\nconst auth = new auth0.WebAuth({\n  clientID: CLIENT_ID,\n  domain: CLIENT_DOMAIN\n})\n\nexport function login () {\n  auth.authorize({\n    responseType: 'token id_token',\n    redirectUri: redirectUri()\n  })\n}\n\nvar router = new Router({\n  mode: 'history'\n})\n\nexport function logout () {\n  clearIdToken()\n  clearAccessToken()\n  router.go('/')\n}\n\nexport function requireAuth (to, from, next) {\n  if (!isLoggedIn()) {\n    next({\n      path: '/login'\n    })\n  } else {\n    next()\n  }\n}\n\nexport function getIdToken () {\n  return localStorage.getItem(ID_TOKEN_KEY)\n}\n\nexport function getAccessToken () {\n  return localStorage.getItem(ACCESS_TOKEN_KEY)\n}\n\nfunction clearIdToken () {\n  localStorage.removeItem(ID_TOKEN_KEY)\n}\n\nfunction clearAccessToken () {\n  localStorage.removeItem(ACCESS_TOKEN_KEY)\n}\n\n// Helper function that will allow us to extract the access_token and id_token\nfunction getParameterByName (name) {\n  let match = RegExp('[#&]' + name + '=([^&]*)').exec(window.location.hash)\n  return match && decodeURIComponent(match[1].replace(/\\+/g, ' '))\n}\n\n// Get and store access_token in local storage\nexport function setAccessToken () {\n  let accessToken = getParameterByName('access_token')\n  localStorage.setItem(ACCESS_TOKEN_KEY, accessToken)\n}\n\n// Get and store id_token in local storage\nexport function setIdToken () {\n  let idToken = getParameterByName('id_token')\n  localStorage.setItem(ID_TOKEN_KEY, idToken)\n}\n\nexport function isLoggedIn () {\n  const idToken = getIdToken()\n  // Had to modify the Auth0 boilerplate here, as somehow the idToken is\n  // cast a the 'null' string instead of being null type the first time\n  // before any login happens...\n  return (idToken !== 'null') && (idToken !== null) && !isTokenExpired(idToken)\n}\n\nfunction getTokenExpirationDate (encodedToken) {\n  const token = decode(encodedToken)\n  if (!token.exp) { return null }\n\n  const date = new Date(0)\n  date.setUTCSeconds(token.exp)\n\n  return date\n}\n\nfunction isTokenExpired (token) {\n  const expirationDate = getTokenExpirationDate(token)\n  return expirationDate < new Date()\n}\n"]}]}